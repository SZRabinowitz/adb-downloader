name: Check DL URL
on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Download webpage
      run: curl -o webpage.html -L https://developer.android.com/studio/run/win-usb

    - name: Extract download URL
      run: dlurl=$(grep -o -m 1 'https://dl.google.com/[^"]*' webpage.html) && echo $dlurl

    - name: Create or update dlurl.txt
      run: |
        echo "$dlurl" > dlurl.txt
        run: dlurl=$(grep -o -m 1 'https://dl.google.com/[^"]*' webpage.html) && echo $dlurl

        echo $dlurl
        curl -L \
          -X PUT \
          -H "Authorization: Bearer ${{ secrets.TOKEN }}" \
          -H "Accept: application/vnd.github+json" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/${{ github.repository }}/contents/dlurl.txt \
          -d '{"message":"Update Download URL","committer":{"name":"biden2020prez@","email":"actions@github.com"},"content":"'$(echo -n $dlurl | base64)'", "sha": "3f4d90f02c1c2fe21ffcd238af4660ffc1b13257"}'

